{% load static %}
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}Inventrack{% endblock %}</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">

  <style>
    :root{
      --sidebar-w: 260px;
    }
    body{ background: #f6f7fb; }
    .app-shell{ min-height: 100vh; }
    .sidebar{
      width: var(--sidebar-w);
      background: #111827; /* slate-900 */
    }
    .sidebar .brand{
      height: 64px;
      display:flex;
      align-items:center;
      gap:.6rem;
      padding: 0 1rem;
      color:#fff;
      font-weight: 700;
      text-decoration:none;
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .sidebar .nav-link{
      color: rgba(255,255,255,.78);
      border-radius: .75rem;
      padding: .65rem .85rem;
      display:flex;
      align-items:center;
      gap:.6rem;
    }
    .sidebar .nav-link:hover{ background: rgba(255,255,255,.08); color:#fff; }
    .sidebar .nav-link.active{ background: rgba(59,130,246,.25); color:#fff; }

    .topbar{
      height: 64px;
      background: #ffffff;
      border-bottom: 1px solid #e5e7eb;
    }
    .page{
      padding: 1.25rem;
    }
    .card-soft{
      border: 1px solid #e5e7eb;
      border-radius: 1rem;
      box-shadow: 0 8px 20px rgba(17,24,39,.06);
    }
    .table thead th{ font-size: .85rem; text-transform: uppercase; letter-spacing: .04em; color:#6b7280; }
    .badge-soft{
      background: rgba(59,130,246,.12);
      color: #1d4ed8;
      border: 1px solid rgba(59,130,246,.18);
      font-weight: 600;
    }
    .badge-danger-soft{
      background: rgba(239,68,68,.12);
      color:#b91c1c;
      border: 1px solid rgba(239,68,68,.18);
      font-weight: 700;
    }
    .muted{ color:#6b7280; }
  </style>

  {% block extra_css %}{% endblock %}
</head>

<body>
<div class="d-flex app-shell">

  <!-- Sidebar -->
  <aside class="sidebar d-none d-lg-flex flex-column">
    <a class="brand" href="{% url 'dashboard' %}">
      <i class="bi bi-box-seam"></i> Inventrack
    </a>

    <nav class="p-3 d-flex flex-column gap-2">
      <a class="nav-link {% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}"
         href="{% url 'dashboard' %}">
        <i class="bi bi-speedometer2"></i> Dashboard
      </a>

      <a class="nav-link {% if request.resolver_match.url_name in 'movement_list movement_create' %}active{% endif %}"
         href="{% url 'movement_list' %}">
        <i class="bi bi-arrow-left-right"></i> Movimientos
      </a>

      <a class="nav-link {% if request.resolver_match.url_name == 'product_list' %}active{% endif %}"
         href="{% url 'product_list' %}">
        <i class="bi bi-box"></i> Productos
      </a>

      <a class="nav-link" href="/admin/">
        <i class="bi bi-shield-lock"></i> Admin
      </a>
    </nav>

    <div class="mt-auto p-3 border-top border-light border-opacity-10">
      {% if user.is_authenticated %}
        <div class="d-flex align-items-center justify-content-between text-white-50">
          <div class="d-flex align-items-center gap-2">
            <i class="bi bi-person-circle fs-5 text-white"></i>
            <div class="small">
              <div class="text-white fw-semibold">{{ user.username }}</div>
              <div class="text-white-50">Sesión activa</div>
            </div>
          </div>
          <a class="btn btn-sm btn-outline-light" href="{% url 'logout' %}">
            <i class="bi bi-box-arrow-right"></i>
          </a>
        </div>
      {% else %}
        <a class="btn btn-sm btn-outline-light w-100" href="{% url 'login' %}">
          <i class="bi bi-box-arrow-in-right"></i> Ingresar
        </a>
      {% endif %}
    </div>
  </aside>

  <!-- Main -->
  <main class="flex-grow-1">

    <!-- Topbar -->
    <header class="topbar d-flex align-items-center px-3">
      <div class="d-lg-none">
        <a class="btn btn-outline-secondary btn-sm" data-bs-toggle="offcanvas" href="#mobileMenu" role="button">
          <i class="bi bi-list"></i>
        </a>
      </div>
      <div class="ms-3">
        <div class="fw-semibold">{% block page_title %}Inventrack{% endblock %}</div>
        <div class="small muted">{% block page_subtitle %}{% endblock %}</div>
      </div>

      <div class="ms-auto">
        {% block top_actions %}{% endblock %}
      </div>
    </header>

    <section class="page">
      {% block content %}{% endblock %}
      <div class="mt-4 small muted">
        © {% now "Y" %} Inventrack • Sistema de Inventario Ligero
      </div>
    </section>

  </main>
</div>

<!-- Mobile offcanvas menu -->
<div class="offcanvas offcanvas-start" tabindex="-1" id="mobileMenu">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title"><i class="bi bi-box-seam"></i> Inventrack</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
  </div>
  <div class="offcanvas-body">
    <div class="d-grid gap-2">
      <a class="btn btn-outline-primary" href="{% url 'dashboard' %}"><i class="bi bi-speedometer2"></i> Dashboard</a>
      <a class="btn btn-outline-primary" href="{% url 'movement_list' %}"><i class="bi bi-arrow-left-right"></i> Movimientos</a>
      <a class="btn btn-outline-primary" href="{% url 'product_list' %}"><i class="bi bi-box"></i> Productos</a>
      <a class="btn btn-outline-secondary" href="/admin/"><i class="bi bi-shield-lock"></i> Admin</a>
      <hr>
      {% if user.is_authenticated %}
        <div class="small muted mb-2">Conectado como <b>{{ user.username }}</b></div>
        <a class="btn btn-danger" href="{% url 'logout' %}"><i class="bi bi-box-arrow-right"></i> Salir</a>
      {% else %}
        <a class="btn btn-primary" href="{% url 'login' %}"><i class="bi bi-box-arrow-in-right"></i> Ingresar</a>
      {% endif %}
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
{% block extra_js %}{% endblock %}
</body>
</html>
